var Bindery=function(){"use strict";var e="v2.1.0",t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},l=function(){function e(){n(this,e),this.pages=[],this.queued=[],this.isComplete=!1,this.estimatedProgress=0}return r(e,[{key:"pagesForSelector",value:function(e){return this.pagesForTest(function(t){return t.element.querySelector(e)})}},{key:"pagesForTest",value:function(e){return this.pages.filter(function(t){return e(t.element)}).map(function(e){return e.number})}},{key:"onComplete",value:function(e){this.isComplete?e():this.queued.push(e)}},{key:"setCompleted",value:function(){this.isComplete=!0,this.estimatedProgress=1,this.queued.forEach(function(e){e()}),this.queued=[]}},{key:"pageCount",get:function(){return this.pages.length}}]),e}(),u=function(e){return e[e.length-1]},c=function(e){var t="",n=e[0],r=!1;return e.forEach(function(i,o){var s=o===e.length-1,a=i===n+1;0===o?t+=""+i:s?t+=a?"â€“"+i:r?"â€“"+n+", "+i:", "+i:a?r=!0:r&&!a?(r=!1,t+="â€“"+n+", "+i):t+=", "+i,n=i}),t},h=/^([+-]?[0-9]+(.?[0-9]+)?)(px|in|cm|mm|pt|pc)$/,d=function(e){return h.test(e)},p=function(e){Object.keys(e).forEach(function(t){if(!d(e[t]))throw"number"==typeof e[t]?Error("Size is missing units { "+t+": "+e[t]+" }"):Error("Invalid size { "+t+": "+e[t]+" }")})},f=function(e){var t=e.match(h);return{val:Number(t[1]),unit:t[3]}},g=function(e,t){var n=!0;return Object.keys(e).forEach(function(r){if(t[r]){var i=e[r],o=t[r];o(i)||(console.error("Bindery: For property '"+t.name+"."+r+"', "+JSON.stringify(i)+" is not a valid value of type "+o.name),n=!1)}else console.error("Bindery: '"+t.name+"' doesn't have property '"+r+"'"),n=!1}),n},m=function(e){return"object"===(void 0===e?"undefined":t(e))},b={enum:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function(e){return t.includes(e)};return Object.defineProperty(r,"name",{writable:!0}),r.name="enum ( '"+t.join("' | '")+"' )",r},any:function(){return!0},string:function(e){return"string"==typeof e},length:d,bool:function(e){return"boolean"==typeof e},func:function(e){return"function"==typeof e},obj:m,array:function(e){return Array.isArray(e)},shape:function(e){return function(t){return m(t)&&g(t,e)}},validate:g},v=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n+=1){var r=t[n].split("=");if(r[0]===e)return r[1]}return!1},y=function(e){return"ðŸ“–-"+e},w=function(e){return"."+y(e)},k=function(e){return"."===e[0]?w(e.substr(1)):y(e)},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=document.createElement("div");return n.className=e.split(".").filter(function(e){return""!==e}).map(k).join(" "),"string"==typeof t?n.textContent=t:Array.isArray(t)&&t.forEach(function(e){return n.appendChild(e)}),n},P=function(){function e(){n(this,e),this.flowContent=C("content"),this.flowBox=C("flowbox",[this.flowContent]),this.footer=C("footer"),this.background=C("background"),this.element=C("page",[this.background,this.flowBox,this.footer])}return r(e,[{key:"overflowAmount",value:function(){var e=this.flowContent.offsetHeight,t=this.flowBox.offsetHeight;if(0===t)throw Error("Bindery: Trying to flow into a box of zero height.");return e-t}},{key:"hasOverflowed",value:function(){return this.overflowAmount()>-5}},{key:"setLeftRight",value:function(e){if("left"===e)this.side=e,this.element.classList.remove(k("right")),this.element.classList.add(k("left"));else{if("right"!==e)throw Error("Bindery: Setting page to invalid direction"+e);this.side=e,this.element.classList.remove(k("left")),this.element.classList.add(k("right"))}}},{key:"setPreference",value:function(e){"left"===e&&(this.alwaysLeft=!0),"right"===e&&(this.alwaysRight=!0)}},{key:"suppressErrors",get:function(){return this.suppress||!1},set:function(e){this.suppress=e,e?this.element.classList.add(k("is-overflowing")):this.element.classList.remove(k("is-overflowing"))}},{key:"isEmpty",get:function(){return!this.hasOutOfFlowContent&&""===this.flowContent.textContent.trim()&&this.flowContent.offsetHeight<1}},{key:"isLeft",get:function(){return"left"===this.side}},{key:"isRight",get:function(){return"right"===this.side}}],[{key:"isSizeValid",value:function(){document.body.classList.remove(k("viewing"));var t=new e,n=document.querySelector(k(".measure-area"));n||(n=document.body.appendChild(C("measure-area"))),n.innerHTML="",n.appendChild(t.element);var r=t.flowBox.getBoundingClientRect();return n.parentNode.removeChild(n),r.height>100&&r.width>100}}]),e}(),S=function e(t){return!!t.hasAttribute("data-ignore-overflow")||!!t.parentElement&&e(t.parentElement)},x=new(function(){function e(){n(this,e),this.numberOfCalls=0,this.resumeLimit=1/0,this.callsSinceResume=0,this.queuedFunc=null,this.isPaused=!1,this.useDelay=!1,this.delayTime=100,this.lastWaitedTime=0}return r(e,[{key:"throttle",value:function(e){var t=this;this.callsSinceResume+=1,this.callsSinceResume>this.resumeLimit&&this.endResume();var n=performance.now()-this.lastWaitedTime;this.isPaused?this.queuedFunc=e:this.useDelay?setTimeout(e,this.delayTime):this.numberOfCalls<800&&n<50?(this.numberOfCalls+=1,e()):(this.numberOfCalls=0,document.hidden?setTimeout(e,1):requestAnimationFrame(function(n){t.lastWaitedTime=n,e()}))}},{key:"pause",value:function(){return this.isPaused?"Already paused":(this.isPaused=!0,"Paused")}},{key:"resumeDelay",value:function(){this.useDelay=!0,this.resume()}},{key:"finish",value:function(){this.useDelay=!1,this.resume()}},{key:"resume",value:function(){return this.isPaused?(this.isPaused=!1,this.queuedFunc?(this.queuedFunc(),this.queuedFunc=null,"Resuming"):"Layout complete"):"Already running"}},{key:"step",value:function(){if(!this.isPaused)return this.pause();if(this.queuedFunc){var e=this.queuedFunc,t=e.name;return this.queuedFunc=null,e(),t}return"Layout complete"}},{key:"resumeFor",value:function(e){return this.callsSinceResume=0,this.resumeLimit=e,this.resume()}},{key:"endResume",value:function(){console.log("Paused after "+this.resumeLimit),this.resumeLimit=1/0,this.callsSinceResume=0,this.pause()}},{key:"isDebugging",get:function(){return this.useDelay},set:function(e){this.useDelay=e,e&&(window.binderyDebug={pause:this.pause.bind(this),resume:this.resume.bind(this),resumeFor:this.resumeFor.bind(this),step:this.step.bind(this),finish:this.finish.bind(this)},console.log("Bindery: Debug layout with the following: \nbinderyDebug.pause() \nbinderyDebug.resume()\n binderyDebug.resumeFor(n) // pauses after n steps, \nbinderyDebug.step()"))}}]),e}()),E=function(){function e(t){n(this,e),this.successArgs=[],this.errorArgs=[],this.successCallback=null,this.errorCallback=null,this.progressCallback=null,this.chainedThenable=null,this.chainedSuccessCallback=null,this.chainedErrorCallback=null,this.isRejected=!1,this.isResolved=!1,this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this),this.updateProgress=this.updateProgress.bind(this),t&&t(this.resolve,this.reject,this.updateProgress)}return r(e,[{key:"then",value:function(e){if(this.chainedThenable)return this.chainedThenable.then(e);if(!this.successCallback)return this.successCallback=e,this.isResolved&&this.resolve(),this;if(!this.chainedSuccessCallback)return this.chainedSuccessCallback=e,this.isResolved&&this.resolveChained(),this;throw Error("need real chained then")}},{key:"progress",value:function(e){return this.progressCallback=e,this}},{key:"catch",value:function(e){if(this.chainedThenable)return this.chainedThenable.catch(e);if(!this.errorCallback)return this.errorCallback=e,this.isRejected&&this.reject(),this;if(!this.chainedErrorCallback)return this.chainedErrorCallback=e,this.isRejected&&this.rejectChained(),this;throw Error("need real chained catch")}},{key:"resolve",value:function(){this.isResolved=!0;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>0&&(this.successArgs=t),null!==this.successCallback){var r=void 0;(r=this.successArgs.length>0?this.successCallback.apply(this,a(this.successArgs)):this.successCallback())&&r.then&&(this.chainedThenable=r),this.chainedSuccessCallback&&this.resolveChained()}}},{key:"resolveChained",value:function(){this.chainedThenable?this.chainedThenable.then(this.chainedSuccessCallback):this.chainedSuccessCallback()}},{key:"reject",value:function(){this.isRejected=!0;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>0&&(this.errorArgs=t),null!==this.errorCallback){var r=void 0;(r=this.errorArgs.length>0?this.errorCallback.apply(this,a(this.errorArgs)):this.errorCallback())&&r.then&&(this.chainedThenable=r),this.successCallback&&r&&r.then&&r.then(this.successCallback),this.chainedSuccessCallback&&(r&&r.then?r.then(this.chainedSuccessCallback):this.chainedSuccessCallback()),this.chainedErrorCallback&&this.rejectChained()}}},{key:"rejectChained",value:function(){this.chainedThenable?this.chainedThenable.catch(this.chainedErrorCallback):this.chainedErrorCallback()}},{key:"updateProgress",value:function(){null!==this.progressCallback&&this.progressCallback.apply(this,arguments)}}],[{key:"resolved",value:function(){return new e(function(e){return e()})}}]),e}(),O=function(e,t,n){return new E(function(r,i){t.appendChild(e),n.hasOverflowed()?(t.removeChild(e),x.throttle(i)):x.throttle(r)})},T=function(e,t,n){return new E(function(r,i){var o=e.nodeValue;if(t.appendChild(e),n.hasOverflowed()&&!S(t)){var s=0;!function t(){if(e.nodeValue=o.substr(0,s),n.hasOverflowed()){for(" "===o.charAt(s)&&(s-=1);" "!==o.charAt(s)&&s>0;)s-=1;if(s<1)return e.nodeValue=o,e.parentNode.removeChild(e),void x.throttle(i);var a=o.substr(0,s),l=o.substr(s);e.nodeValue=a;var u=document.createTextNode(l);x.throttle(function(){return r(u)})}else if(s>o.length-1)x.throttle(r);else{for(s+=1;" "!==o.charAt(s)&&s<o.length;)s+=1;x.throttle(t)}}()}else x.throttle(r)})},A=function e(t){var r=this;n(this,e),this.name=t.name?t.name:"Unnamed Bindery Rule",this.selector="",Object.keys(t).forEach(function(e){r[e]=t[e]})},z=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="Out of Flow",r}return o(t,A),r(t,[{key:"beforeAdd",value:function(e){return e.setAttribute("data-ignore-overflow",!0),e}},{key:"afterAdd",value:function(e,t,n,r){return this.createOutOfFlowPages(e,t,r),("same"!==this.continue||t.pageInProgress.hasOutOfFlowContent)&&(n(!0),"left"!==this.continue&&"right"!==this.continue||t.pageInProgress.setPreference(this.continue)),e}}]),t}(),L=function(e){function t(e){n(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"FullBleedPage",selector:b.string,continue:b.enum("next","same","left","right"),rotate:b.enum("none","inward","outward","clockwise","counterclockwise")}),r}return o(t,z),r(t,[{key:"createOutOfFlowPages",value:function(e,t,n){e.parentNode.removeChild(e);var r=void 0;if(t.pageInProgress.isEmpty?r=t.pageInProgress:(r=n(),t.pages.push(r)),"none"!==this.rotate){var i=C(".rotate-container.page-size-rotated.rotate-"+this.rotate);i.appendChild(r.background),r.element.appendChild(i)}r.background.appendChild(e),r.hasOutOfFlowContent=!0}}]),t}(),R=function(e){function t(e){n(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"FullBleedSpread",selector:b.string,continue:b.enum("next","same","left","right"),rotate:b.enum("none","clockwise","counterclockwise")}),r}return o(t,z),r(t,[{key:"createOutOfFlowPages",value:function(e,t,n){var r=this;e.parentNode.removeChild(e);var i=void 0;t.pageInProgress.isEmpty?i=t.pageInProgress:(i=n(),t.pages.push(i));var o=n();t.pages.push(o),"none"!==this.rotate&&[i,o].forEach(function(e){var t=C(".rotate-container.spread-size-rotated.rotate-spread-"+r.rotate);t.appendChild(e.background),e.element.appendChild(t)}),i.background.appendChild(e),i.element.classList.add(k("spread")),i.setPreference("left"),i.isOutOfFlow="same"===this.continue,i.hasOutOfFlowContent=!0,o.background.appendChild(e.cloneNode(!0)),o.element.classList.add(k("spread")),o.setPreference("right"),o.isOutOfFlow="same"===this.continue,o.hasOutOfFlowContent=!0}}]),t}(),B=function(e){function t(e){n(this,t),e.position=e.position||"before",e.continue=e.continue||"next";var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"PageBreak",selector:b.string,continue:b.enum("next","left","right"),position:b.enum("before","after","both","avoid")}),r}return o(t,A),r(t,[{key:"beforeAdd",value:function(e,t,n){return"before"!==this.position&&"both"!==this.position||(t.pageInProgress.isEmpty||n(),"next"!==this.continue&&t.pageInProgress.setPreference(this.continue)),e}},{key:"afterAdd",value:function(e,t,n){if("after"===this.position||"both"===this.position){var r=n(!0);"next"!==this.continue&&r.setPreference(this.continue)}return e}},{key:"avoidSplit",get:function(){return"avoid"===this.position}}]),t}(),_=function(e){var t=e.tagName.toLowerCase(),n=e.id?"#"+e.id:"",r="";e.classList.length>0&&(r="."+[].concat(a(e.classList)).join("."));var i="";return n.length<1&&r.length<2&&(i='("'+e.textContent.substr(0,30).replace(/\s+/g," ")+'...")'),t+n+r+i},I=function(e){return e instanceof R||e instanceof L||e instanceof B},N=function(e){var t=e.filter(I),n=e.filter(function(e){return!t.includes(e)}),r=t.find(function(e){return e instanceof R}),i=t.find(function(e){return e instanceof L});return r?n.push(r):i?n.push(i):n.push.apply(n,a(t)),n},F=function(){function e(t){n(this,e),this.rules=t,this.pageRules=t.filter(function(e){return e.eachPage}),this.beforeAddRules=t.filter(function(e){return e.selector&&e.beforeAdd}),this.afterAddRules=t.filter(function(e){return e.selector&&e.afterAdd}),this.selectorsNotToSplit=t.filter(function(e){return e.avoidSplit}).map(function(e){return e.selector})}return r(e,[{key:"setup",value:function(){this.rules.forEach(function(e){e.setup&&e.setup()})}},{key:"startPage",value:function(e,t){this.rules.forEach(function(n){n.afterPageCreated&&n.afterPageCreated(e,t)})}},{key:"finishEveryPage",value:function(e){this.pageRules.forEach(function(t){e.pages.forEach(function(n){t.eachPage(n,e)})})}},{key:"finishPage",value:function(e,t){this.pageRules.forEach(function(n){n.eachPage(e,t)})}},{key:"beforeAddElement",value:function(e,t,n,r){var i=e;return this.beforeAddRules.filter(function(e){return i.matches(e.selector)}).forEach(function(e){i=e.beforeAdd(i,t,n,r)}),i}},{key:"afterAddElement",value:function(e,t,n,r,i){var o=e,s=this.afterAddRules.filter(function(e){return o.matches(e.selector)});return N(s).forEach(function(e){o=e.afterAdd(o,t,n,r,function(o){return i(o),e.afterAdd(o,t,n,r,function(){console.log("Couldn't apply "+e.name+" to "+_(o)+". Caused overflows twice.")})})}),o}}]),e}(),M=function(e,t){for(var n=t;n<e.length;n+=1)if(!e[n].isOutOfFlow)return n;return t},j=function(e,t){for(var n=e.slice(),r=0;r<n.length;r+=1){var i=n[r],o=r%2!=0;if(o&&i.alwaysRight||!o&&i.alwaysLeft)if(i.isOutOfFlow){var s=M(n,r+1),a=n[s];n.splice(s,1),n.splice(r,0,a)}else n.splice(r,0,t())}return n},D=function(e){e.forEach(function(e,t){e.number=t+1,e.setLeftRight(t%2==0?"right":"left")});var t={h1:"",h2:"",h3:"",h4:"",h5:"",h6:""};e.forEach(function(e){e.heading={},Object.keys(t).forEach(function(n,r){var i=e.element.querySelector(n);i&&(t[n]=i.textContent,Object.keys(t).forEach(function(e,n){n>r&&(t[e]="")})),""!==t[n]&&(e.heading[n]=t[n])})})},H=function(e,t){for(var n=[],r=t.filter(function(e){return e.customToNextClass}).map(function(e){return e.customToNextClass}),i=t.filter(function(e){return e.customFromPreviousClass}).map(function(e){return e.customFromPreviousClass}),o=e.length-1;o>=0;o-=1){var s=e[o],a=s.cloneNode(!1);if(a.innerHTML="",function(e){e.classList.add(k("continues")),r.forEach(function(t){return e.classList.add(t)})}(s),function(e){e.classList.add(k("continuation")),i.forEach(function(t){return e.classList.add(t)})}(a),"OL"===a.tagName){var l=1;s.hasAttribute("start")&&(l=parseInt(s.getAttribute("start"),10)),o<e.length-1&&"LI"===e[o+1].tagName&&(l-=1);var u=l+s.children.length;a.setAttribute("start",u)}o<e.length-1&&a.appendChild(n[o+1]),n[o]=a}return n},q=function(e){return new E(function(t){var n=setInterval(function(){e.naturalWidth&&(clearInterval(n),t())},10);e.addEventListener("error",function(){clearInterval(n),t()}),e.src=e.src})},U=function(e){return e.nodeType===Node.TEXT_NODE},V=function(e){return e.nodeType===Node.ELEMENT_NODE},W=function(e){return"SCRIPT"===e.tagName},G=function(e){return"IMG"===e.tagName},K=function(e){return G(e)&&!e.naturalWidth},Y=function(e){return V(e)&&!W(e)},Z=function(e){return(e/1e3).toFixed(2)},J=function e(t,n){return n.some(function(e){return t.matches(e)})?!(!t.hasAttribute("data-bindery-did-move")&&!t.classList.contains(k("continuation"))):!t.parentElement||e(t.parentElement,n)},X=function(e,t){return new E(function(n,r,i){var o=0,s=0,c=0,h=new F(t),d=document.body.appendChild(C(".measure-area")),p=[],f=new l,g=function(){return!S(u(p))},m=function(){var e=new P;return d.appendChild(e.element),h.startPage(e,f),e},b=function(e,t){if(e&&e.hasOverflowed()&&(console.warn("Bindery: Page overflowing",f.pageInProgress.element),!e.suppressErrors&&!t))throw r("Moved to new page when last one is still overflowing"),Error("Bindery: Moved to new page when last one is still overflowing");f.pages=j(f.pages,m),D(f.pages),e&&h.finishPage(e,f)},v=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(f.pages.length>2e3)throw r("Maximum page count exceeded"),Error("Bindery: Maximum page count exceeded. Suspected runaway layout.");b(f.pageInProgress,e),p=H(p,t);var n=m();if(f.pageInProgress=n,i(f),f.pages.push(n),p[0]&&n.flowContent.appendChild(p[0]),n.hasOverflowed()){var o=u(p);o?(console.warn("Bindery: Content overflows, probably due to a style set on "+_(o)+"."),o.parentNode.removeChild(o)):console.warn("Bindery: Content overflows.")}return n},y=function(e){if(p.pop(),p.length<1)throw Error("Bindery: Attempting to move the top-level element");for(var t=e,n=[];p.length>1&&!J(u(p),h.selectorsNotToSplit);)t=p.pop(),n.unshift(t);t.setAttribute("data-bindery-did-move",!0);var r=t.parentNode;r.removeChild(t),p.length>1&&""===u(p).textContent.trim()&&(r.appendChild(t),t=p.pop(),n.unshift(t),t.parentNode.removeChild(t)),f.pageInProgress.isEmpty||(f.pageInProgress.hasOverflowed()&&(f.pageInProgress.suppressErrors=!0),v()),u(p).appendChild(t),n.forEach(function(e){p.push(e)}),p.push(e)},w=function(e,t){return new E(function(n){t.appendChild(e),g()&&(f.pageInProgress.suppressErrors=!0,v()),n()})},k=function e(t){return new E(function(n,r){T(t,u(p),f.pageInProgress).then(function(t){t?(v(),e(t).then(n).catch(r)):n()}).catch(r)})},x=function(e){return J(e,h.selectorsNotToSplit)&&!S(e)},A=function(e,t){return(x(t)?k(e).catch(function(){return p.length<2?w(e,u(p)):(y(t),k(e))}):O(e,u(p),f.pageInProgress).catch(function(){return g()&&y(t),O(e,u(p),f.pageInProgress)})).catch(function(){return w(e,u(p))})},z=void 0,L=function(e,t){if(U(e))return A(e,t);if(K(e)){var n=performance.now();return q(e).then(function(){return o+=performance.now()-n,z(e)})}return Y(e)?z(e):E.resolved()};z=function(e){return new E(function(t){f.pageInProgress.hasOverflowed()&&g()&&(f.pageInProgress.suppressErrors=!0,v());var n=h.beforeAddElement(e,f,v,m);p[0]?u(p).appendChild(n):f.pageInProgress.flowContent.appendChild(n),p.push(n);var r=[].concat(a(n.childNodes));n.innerHTML="",f.pageInProgress.hasOverflowed()&&g()&&y(n);var i=function(){var e=p.pop();h.afterAddElement(e,f,v,m,function(e){e.parentNode.removeChild(e),v(),u(p).appendChild(e)}),c+=1,f.estimatedProgress=c/s,t()},o=0;!function e(){if(o<r.length){var t=r[o];o+=1,L(t,n).then(e)}else i()}()})},function(){var t=window.performance.now();h.setup(),e.style.margin=0,e.style.padding=0,s=e.querySelectorAll("*").length,v(),z(e).then(function(){document.body.removeChild(d),f.pages=j(f.pages,m),D(f.pages),f.setCompleted(),h.finishEveryPage(f);var e=window.performance.now()-t,r=e-o;console.log("ðŸ“– Book ready in "+Z(e)+"s (Layout: "+Z(r)+"s, Waiting for images: "+Z(o)+"s)"),n(f)})}()})},$=Object.freeze({FLIPBOOK:"view_flipbook",PREVIEW:"view_preview",PRINT:"view_print"}),Q=Object.freeze({AUTO:"paper_auto",AUTO_BLEED:"paper_auto_bleed",AUTO_MARKS:"paper_auto_marks",LETTER_PORTRAIT:"paper_letter_p",LETTER_LANDSCAPE:"paper_letter_l",A4_PORTRAIT:"paper_a4_p",A4_LANDSCAPE:"paper_a4_l"}),ee=Object.freeze({PAGES:"layout_pages",SPREADS:"layout_spreads",BOOKLET:"layout_booklet"}),te=Object.freeze({NONE:"marks_none",SPREADS:"layout_spreads",BOTH:"marks_both"}),ne={width:"8.5in",height:"11in"},re={width:"210mm",height:"297mm"},ie={bleed:"12pt",size:{width:"4in",height:"6in"},margin:{inner:"24pt",outer:"24pt",bottom:"40pt",top:"48pt"}},oe=!!window.chrome&&!!window.chrome.webstore,se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.setSize(t.size||ie.size),this.setMargin(t.margin||ie.margin),this.setBleed(t.bleed||ie.bleed)}return r(e,[{key:"setupPaper",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sheetSizeMode=oe?e.paper||Q.AUTO:Q.AUTO_MARKS,this.printTwoUp=e.layout&&e.layout!==ee.PAGES}},{key:"setSize",value:function(e){p(e),this.size=e}},{key:"setMargin",value:function(e){p(e),this.margin=e}},{key:"setBleed",value:function(e){this.bleed=e}},{key:"setPrintTwoUp",value:function(e){this.printTwoUp=e}},{key:"isSizeValid",value:function(){return this.updateStylesheet(),P.isSizeValid()}},{key:"spreadSizeStyle",value:function(){var e=f(this.size.width);return{height:this.size.height,width:""+2*e.val+e.unit}}},{key:"updateStylesheet",value:function(){var e=void 0,t=document.querySelector("#binderyPageSetup");t?e=t:(e=document.createElement("style")).id="binderyPageSetup";var n=f(this.size.width);e.innerHTML="\n@page { size: "+this.sheetSize.width+" "+this.sheetSize.height+"; }\n"+k(".print-page")+" { width: "+this.sheetSize.width+"; height: "+this.sheetSize.height+";}\n\n"+k(".show-crop")+" "+k(".print-page")+" "+k(".spread-wrapper")+",\n"+k(".show-bleed-marks")+" "+k(".print-page")+" "+k(".spread-wrapper")+" {\n  margin: calc("+this.bleed+" + 12pt) auto;\n}\nhtml {\n  --bindery-page-width: "+this.size.width+";\n  --bindery-page-height: "+this.size.height+";\n}\n"+k(".page-size-rotated")+" {\n  height: "+this.size.width+";\n  width: "+this.size.height+";\n}\n"+k(".spread-size")+" {\n  height: "+this.size.height+";\n  width: "+2*n.val+n.unit+";\n}\n"+k(".spread-size-rotated")+" {\n  height: "+2*n.val+n.unit+";\n  width: "+this.size.height+";\n}\n"+k(".flowbox")+",\n"+k(".footer")+" {\n  margin-left: "+this.margin.inner+";\n  margin-right: "+this.margin.outer+";\n}\n"+k(".left")+" "+k(".flowbox")+",\n"+k(".left")+" "+k(".footer")+" {\n  margin-left: "+this.margin.outer+";\n  margin-right: "+this.margin.inner+";\n}\n\n"+k(".left")+" "+k(".running-header")+" {\n  left: "+this.margin.outer+";\n}\n"+k(".right")+" "+k(".running-header")+" {\n  right: "+this.margin.outer+";\n}\n\n"+k(".flowbox")+" { margin-top: "+this.margin.top+"; }\n"+k(".footer")+"{ margin-bottom: "+this.margin.bottom+"; }\n\n"+k(".bleed-left")+",\n"+k(".bleed-right")+",\n"+k(".crop-left")+",\n"+k(".crop-right")+",\n"+k(".crop-fold")+" {\n  top: calc( -12pt - "+this.bleed+" );\n  bottom: calc( -12pt - "+this.bleed+" );\n}\n\n"+k(".bleed-top")+",\n"+k(".bleed-bottom")+",\n"+k(".crop-top")+",\n"+k(".crop-bottom")+" {\n  left: calc( -12pt - "+this.bleed+" );\n  right: calc( -12pt - "+this.bleed+" );\n}\n"+k(".bleed-left")+"   { left: -"+this.bleed+"; }\n"+k(".bleed-right")+"  { right: -"+this.bleed+"; }\n"+k(".bleed-top")+"    { top: -"+this.bleed+"; }\n"+k(".bleed-bottom")+" { bottom: -"+this.bleed+"; }\n\n"+k(".background")+" {\n  top: -"+this.bleed+";\n  bottom: -"+this.bleed+";\n  left: -"+this.bleed+";\n  right: -"+this.bleed+";\n}\n\n"+k(".spread")+k(".right")+" > "+k(".background")+" {\n  left: calc(-100% - "+this.bleed+");\n}\n"+k(".spread")+k(".left")+" > "+k(".background")+" {\n  right: calc(-100% - "+this.bleed+");\n}\n    ",document.head.appendChild(e)}},{key:"displaySize",get:function(){return{width:this.printTwoUp?this.spreadSizeStyle().width:this.size.width,height:this.size.height,bleed:this.bleed}}},{key:"sheetSize",get:function(){var e=this.printTwoUp?this.spreadSizeStyle().width:this.size.width,t=this.size.height,n=this.bleed;switch(this.sheetSizeMode){case Q.AUTO:return{width:e,height:t};case Q.AUTO_BLEED:return{width:"calc("+e+" + "+n+" + "+n+")",height:"calc("+t+" + "+n+" + "+n+")"};case Q.AUTO_MARKS:return{width:"calc("+e+" + "+n+" + "+n+" + 24pt)",height:"calc("+t+" + "+n+" + "+n+" + 24pt)"};case Q.LETTER_LANDSCAPE:return{width:ne.height,height:ne.width};case Q.LETTER_PORTRAIT:return ne;case Q.A4_PORTRAIT:return re;case Q.A4_LANDSCAPE:return{width:re.height,height:re.width}}return{width:e,height:t}}}]),e}(),ae=function(t,n){return C(".error",[C(".error-title",t),C(".error-text",n),C(".error-footer","Bindery "+e)])},le=function(e,t){for(;e.length%4!=0;){var n=t();n.element.style.visibility="hidden",e.push(n)}for(var r=[],i=e.length,o=0;o<i/2;o+=2)r.push(e[i-1-o]),r.push(e[o]),r.push(e[o+1]),r.push(e[i-2-o]);return r},ue=function(e,t){if(e.length%2!=0){var n=t();e.push(n)}var r=t(),i=t();return r.element.style.visibility="hidden",i.element.style.visibility="hidden",e.unshift(r),e.push(i),e},ce=function(e){return C(".spread-wrapper.spread-size",e)},he=function(e){return C(".spread-wrapper.page-size",e)},de=function(e,t){var n=document.createDocumentFragment();if(t)for(var r=0;r<e.length;r+=2){var i=ce([e[r].element,e[r+1].element]);n.appendChild(i)}else e.forEach(function(e){var t=he([e.element]);n.appendChild(t)});return n},pe=["top","bottom","left","right"],fe=function(){return pe.map(function(e){return C(".bleed-"+e)})},ge=function(){return pe.map(function(e){return C(".crop"+e)})},me=function(){return C(".print-mark-wrap",[].concat(a(ge()),a(fe())))},be=function(){return C(".print-mark-wrap",[C(".crop-fold")].concat(a(ge()),a(fe())))},ve=function(e,t){var n=e%4==0,r=parseInt((e+1)/4,10)+1;return C(".print-meta","Sheet "+r+" of "+t/4+": "+(n?"Outside":"Inside"))},ye=function(e){return C(".spread-wrapper.spread-size",e)},we=function(e){return C(".spread-wrapper.page-size",e)},ke=function(e,t,n){var r=document.createDocumentFragment(),i=t?be:me,o=t?ye:we,s=function(e){return C(".print-page",[o(e)])};if(t)for(var a=0;a<e.length;a+=2){var l=i();if(n){var u=ve(a,e.length);l.appendChild(u)}var c=s([e[a].element,e[a+1].element,l]);r.appendChild(c)}else e.forEach(function(e){var t=s([e.element,i()]);r.appendChild(t)});return r},Ce=function(e,t){var n=document.createDocumentFragment(),r=C(".spread-size.flip-sizer"),i=C(".spread-size.flap-holder");r.appendChild(i),n.appendChild(r);var o=[],s=-1,a=4;e.length*a>60&&(a=60/e.length),i.style.width=e.length*a+"px";for(var l=function(e){var t=e;t===s&&(t+=1),s=t;var n=4;o.length*n>200&&(n=200/o.length),o.forEach(function(e,r,i){var o=(i.length-Math.abs(r-t+.5))*n;e.style.transform="translate3d("+(r<t?4:0)+"px,0,"+o+"px) rotateY("+(r<t?-180:0)+"deg)"})},u=0,c=1;c<e.length-1;c+=t?2:1)!function(n){var r=u+=1,s=C(".page3d");s.addEventListener("click",function(){l(r-1)});var c=e[n].element,h=void 0;c.classList.add(k("page3d-front")),s.appendChild(c),t?(s.classList.add(k("doubleSided")),(h=e[n+1].element).classList.add(k("page3d-back")),s.appendChild(h)):(h=C(".page.page3d-back"),s.appendChild(h)),s.style.left=n*a+"px",o.push(s),i.appendChild(s)}(c);return l(0),n},Pe={};Pe[$.PREVIEW]="preview",Pe[$.PRINT]="print",Pe[$.FLIPBOOK]="flip";var Se=function(){function e(t){var r=this,i=t.bindery,o=t.mode,s=t.layout,a=t.marks,l=t.ControlsComponent;n(this,e),this.book=null,this.pageSetup=i.pageSetup,this.progressBar=C(".progress-bar"),this.zoomBox=C("zoom-wrap"),this.element=C("root",[this.progressBar,this.zoomBox]),this.doubleSided=!0,this.printArrange=s,this.setMarks(a),this.mode=o,this.element.setAttribute("bindery-view-mode",Pe[this.mode]),this.currentLeaf=0,this.listenForPrint(),this.listenForResize(),this.setPrint=this.setPrint.bind(this),l&&(this.controls=new l({Mode:$,Paper:Q,Layout:ee,Marks:te},{paper:this.pageSetup.sheetSizeMode,layout:this.printArrange,mode:this.mode,marks:a},{setMode:function(e){e!==r.mode&&(r.mode=e,r.render())},setPaper:this.setSheetSize.bind(this),setLayout:this.setPrintArrange.bind(this),setMarks:this.setMarks.bind(this),getPageSize:function(){return r.pageSetup.displaySize}}),this.element.appendChild(this.controls.element)),this.element.classList.add(k("in-progress")),document.body.appendChild(this.element)}return r(e,[{key:"listenForPrint",value:function(){var e=this;window.matchMedia&&window.matchMedia("print").addListener(function(t){t.matches&&e.setPrint()}),document.body.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&80===t.keyCode&&(t.preventDefault(),e.setPrint(),setTimeout(function(){window.print()},10))})}},{key:"listenForResize",value:function(){var e=this;window.addEventListener("resize",function(){e.throttleResize||(e.updateZoom(),e.throttleResize=setTimeout(function(){e.throttleResize=null},20))})}},{key:"setInProgress",value:function(){this.element.classList.add(k("in-progress")),this.controls&&this.controls.setInProgress()}},{key:"setSheetSize",value:function(e){var t=this;this.pageSetup.sheetSizeMode=e,this.pageSetup.updateStylesheet(),this.mode!==$.PRINT&&this.setPrint(),this.updateZoom(),setTimeout(function(){t.updateZoom()},300)}},{key:"setPrintArrange",value:function(e){e!==this.printArrange&&(this.printArrange=e,this.pageSetup.setPrintTwoUp(this.isTwoUp),this.pageSetup.updateStylesheet(),this.mode===$.PRINT?this.render():this.setPrint())}},{key:"setMarks",value:function(e){switch(e){case te.NONE:this.isShowingCropMarks=!1,this.isShowingBleedMarks=!1;break;case te.CROP:this.isShowingCropMarks=!0,this.isShowingBleedMarks=!1;break;case te.BLEED:this.isShowingCropMarks=!1,this.isShowingBleedMarks=!0;break;case te.BOTH:this.isShowingCropMarks=!0,this.isShowingBleedMarks=!0}}},{key:"displayError",value:function(e,t){this.element.parentNode||document.body.appendChild(this.element),this.error||(this.error=ae(e,t),this.element.appendChild(this.error))}},{key:"clear",value:function(){this.book=null,this.lastSpreadInProgress=null,this.zoomBox.innerHTML=""}},{key:"cancel",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"toggleBleed",value:function(){this.element.classList.add(k("show-bleed"))}},{key:"toggleDouble",value:function(){this.doubleSided=!this.doubleSided,this.render()}},{key:"setPrint",value:function(){this.mode!==$.PRINT&&(this.mode=$.PRINT,this.render())}},{key:"render",value:function(){var e=this;if(this.book){var t=document.body;this.element.parentNode||t.appendChild(this.element),this.flaps=[],t.classList.add(k("viewing")),this.element.setAttribute("bindery-view-mode",Pe[this.mode]);var n=t.scrollHeight-t.offsetHeight,r=t.scrollTop/n;this.controls&&this.controls.setDone(this.book.pages.length),this.progressBar.style.width="100%",window.requestAnimationFrame(function(){e.mode===$.PREVIEW?e.renderGrid():e.mode===$.FLIPBOOK?e.renderInteractive():e.mode===$.PRINT?e.renderPrint():e.renderGrid(),t.scrollTop=n*r,e.updateZoom()})}}},{key:"renderProgress",value:function(e){var t=this;this.book=e,this.progressBar.style.width=100*this.book.estimatedProgress+"%",this.controls&&this.controls.updateProgress(this.book.pages.length,this.book.estimatedProgress);var n=this.mode===$.PREVIEW||this.mode===$.PRINT&&this.printArrange!==ee.PAGES,r=n?2:1,i=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return C(".spread-wrapper",[].concat(t))};this.book.pages.forEach(function(e,o){if(!t.zoomBox.contains(e.element)||e.element.parentNode===t.zoomBox)if(t.lastSpreadInProgress&&t.lastSpreadInProgress.children.length<r)t.lastSpreadInProgress.appendChild(e.element);else{if(0===o&&n){var s=new P;s.element.style.visibility="hidden",t.lastSpreadInProgress=i(s.element,e.element)}else t.lastSpreadInProgress=i(e.element);t.zoomBox.appendChild(t.lastSpreadInProgress)}}),this.book.pageInProgress&&this.zoomBox.appendChild(this.book.pageInProgress.element),this.updateZoom()}},{key:"updateZoom",value:function(){if(this.zoomBox.firstElementChild){var e=document.body.scrollTop/document.body.scrollHeight,t=this.zoomBox.getBoundingClientRect(),n=this.zoomBox.firstElementChild.getBoundingClientRect().width,r=Math.min(1,t.width/n);this.zoomBox.style.transform="scale("+r+")",document.body.scrollTop=document.body.scrollHeight*e}}},{key:"renderPrint",value:function(){this.element.classList.add(k("show-bleed")),this.zoomBox.innerHTML="";var e=this.printArrange===ee.BOOKLET,t=this.book.pages.slice();this.printArrange===ee.SPREADS?t=ue(t,function(){return new P}):e&&(t=le(t,function(){return new P}));var n=ke(t,this.isTwoUp,e);this.zoomBox.appendChild(n)}},{key:"renderGrid",value:function(){this.zoomBox.innerHTML="",this.element.classList.remove(k("show-bleed"));var e=this.book.pages.slice();this.doubleSided&&(e=ue(e,function(){return new P}));var t=de(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"renderInteractive",value:function(){this.zoomBox.innerHTML="",this.flaps=[],this.element.classList.remove(k("show-bleed"));var e=ue(this.book.pages.slice(),function(){return new P}),t=Ce(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"isTwoUp",get:function(){return this.printArrange!==ee.PAGES}},{key:"isShowingCropMarks",get:function(){return this.element.classList.contains(k("show-crop"))},set:function(e){e?(this.element.classList.add(k("show-crop")),this.setPrint()):this.element.classList.remove(k("show-crop"))}},{key:"isShowingBleedMarks",get:function(){return this.element.classList.contains(k("show-bleed-marks"))},set:function(e){e?(this.element.classList.add(k("show-bleed-marks")),this.setPrint()):this.element.classList.remove(k("show-bleed-marks"))}}]),e}(),xe=function(e){function t(e){n(this,t),e.toNext=e.toNext||"split-to-next",e.fromPrevious=e.fromPrevious||"split-from-previous";var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"Split",selector:b.string,toNext:b.string,fromPrevious:b.string}),r}return o(t,A),r(t,[{key:"customToNextClass",get:function(){return this.toNext}},{key:"customFromPreviousClass",get:function(){return this.fromPrevious}}]),t}(),Ee=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.selector="*",r.counterValue=0,b.validate(e,{name:"Counter",replaceEl:b.string,resetEl:b.string,incrementEl:b.string,replace:b.func}),r}return o(t,A),r(t,[{key:"setup",value:function(){this.counterValue=0}},{key:"beforeAdd",value:function(e){return e.matches(this.incrementEl)&&(this.counterValue+=1),e.matches(this.resetEl)&&(this.counterValue=0),e.matches(this.replaceEl)?this.createReplacement(e):e}},{key:"createReplacement",value:function(e){return this.replace(e,this.counterValue)}},{key:"replace",value:function(e,t){return e.textContent=t,e}}]),t}(),Oe=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="Replace",r}return o(t,A),r(t,[{key:"afterAdd",value:function(e,t,n,r,i){var o=e.parentNode;if(!o)throw Error("Bindery: Rule assumes element has been added but it has no parent.",e);var s=e.cloneNode(!0),a=this.createReplacement(t,s);return o.replaceChild(a,e),t.pageInProgress.hasOverflowed()?(o.replaceChild(e,a),i(e)):a}},{key:"createReplacement",value:function(e,t){return this.replace(t)}},{key:"replace",value:function(e){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">Default Replacement</sup>'),e}}]),t}(),Te=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"Footnote",selector:b.string,replace:b.func,render:b.func}),r}return o(t,Oe),r(t,[{key:"afterAdd",value:function(e,n,r,o,s){var a=n.pageInProgress.footer.children.length+1,l=C(".footnote"),u=this.render(e,a);return u instanceof HTMLElement?l.appendChild(u):l.innerHTML=u,n.pageInProgress.footer.appendChild(l),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterAdd",this).call(this,e,n,r,o,function(e){return n.pageInProgress.footer.removeChild(l),s(e)})}},{key:"createReplacement",value:function(e,t){var n=e.pageInProgress.footer.children.length;return this.replace(t,n)}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">'+t+"</sup>"),e}},{key:"render",value:function(e,t){return"<sup>"+t+"</sup> Default footnote (<a href='/bindery/docs/#footnote'>Learn how to change it</a>)"}}]),t}(),Ae=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"PageReference",selector:b.string,replace:b.func,createTest:b.func}),r}return o(t,Oe),r(t,[{key:"afterAdd",value:function(e,t){var n=this,r=this.createTest(e);if(r){var i=e.parentNode,o=e.cloneNode(!0),s=t.pagesForTest(r),a=c(s),l=this.replace(o,a||"###");return l.classList.add(k("placeholder-pulse")),i.replaceChild(l,e),t.onComplete(function(){var i=l.parentNode,o=e.cloneNode(!0),s=t.pagesForTest(r),a=c(s),u=n.replace(o,a);i.replaceChild(u,l)}),l}return e}},{key:"createTest",value:function(e){var t=e.getAttribute("href");return t?(t=t.replace("#",""),t='[id="'+t+'"]',function(e){return e.querySelector(t)}):null}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeend",", <span>"+t+"</span>"),e}}]),t}(),ze=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b.validate(e,{name:"RunningHeader",render:b.func}),r}return o(t,A),r(t,[{key:"eachPage",value:function(e){if(!e.runningHeader){var t=C(".running-header");e.element.appendChild(t),e.runningHeader=t}e.runningHeader.innerHTML=this.render(e)}},{key:"render",value:function(e){return e.number}}]),t}(),Le={Rule:A,Split:function(e){return new xe(e)},Counter:function(e){return new Ee(e)},FullBleedPage:function(e){return new L(e)},Footnote:function(e){return new Te(e)},RunningHeader:function(e){return new ze(e)},Replace:function(e){return new Oe(e)},FullBleedSpread:function(e){return new R(e)},PageBreak:function(e){return new B(e)},PageReference:function(e){return new Ae(e)},createRule:function(e){return new A(e)}},Re=Le.PageBreak,Be=Le.PageReference,_e=Le.Footnote,Ie=Le.FullBleedPage,Ne=Le.FullBleedSpread,Fe=function(e,t){return e.textContent=""+t,e},Me=[Re({selector:'[book-page-break="both"]',position:"both"}),Re({selector:'[book-page-break="avoid"]',position:"avoid"}),Re({selector:'[book-page-break="after"][book-page-continue="right"]',position:"after",continue:"right"}),Re({selector:'[book-page-break="after"][book-page-continue="left"]',position:"after",continue:"left"}),Re({selector:'[book-page-break="after"][book-page-continue="next"]',position:"after",continue:"next"}),Re({selector:'[book-page-break="before"][book-page-continue="right"]',position:"before",continue:"right"}),Re({selector:'[book-page-break="before"][book-page-continue="left"]',position:"before",continue:"left"}),Re({selector:'[book-page-break="before"][book-page-continue="next"]',position:"before",continue:"next"}),Ie({selector:'[book-full-bleed="page"]'}),Ne({selector:'[book-full-bleed="spread"]'}),_e({selector:"[book-footnote-text]",render:function(e,t){return"<i>"+t+"</i>"+e.getAttribute("book-footnote-text")}}),Be({selector:"[book-pages-with-text]",replace:Fe,createTest:function(e){var t=e.getAttribute("book-pages-with-text").toLowerCase().trim();return function(e){return e.textContent.toLowerCase().includes(t)}}}),Be({selector:"[book-pages-with-selector]",replace:Fe,createTest:function(e){var t=e.getAttribute("book-pages-with-selector").trim();return function(e){return e.querySelector(t)}}}),Be({selector:"[book-pages-with]",replace:Fe,createTest:function(e){var t=e.textContent.toLowerCase().trim();return function(e){return e.textContent.toLowerCase().includes(t)}}})];!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t)}}('@charset "UTF-8";@media screen{.ðŸ“–-page{background:#fff;outline:1px solid #ddd;box-shadow:0 2px 4px -1px rgba(0,0,0,.15);overflow:hidden}.ðŸ“–-show-bleed .ðŸ“–-page{box-shadow:none;outline:none;overflow:visible}.ðŸ“–-page:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:3}}li.ðŸ“–-continuation,p.ðŸ“–-continuation{text-indent:unset!important}li.ðŸ“–-continuation{list-style:none!important}.ðŸ“–-out-of-flow{display:none}.ðŸ“–-page{width:var(--bindery-page-width);height:var(--bindery-page-height);position:relative;display:flex;flex-direction:column;flex-wrap:nowrap}.ðŸ“–-flowbox{position:relative;margin:60px 40px;margin-bottom:0;flex:1 1 auto;min-height:0}.ðŸ“–-content{padding:.1px;position:relative}.ðŸ“–-footer{margin:60px 40px;margin-top:8pt;flex:0 1 auto;z-index:1}.ðŸ“–-background{position:absolute;z-index:0;overflow:hidden}.ðŸ“–-left>.ðŸ“–-background{right:0}.ðŸ“–-right>.ðŸ“–-background{left:0}.ðŸ“–-sup{font-size:.667em}.ðŸ“–-footer,.ðŸ“–-running-header{font-size:10pt}.ðŸ“–-running-header{position:absolute;text-align:center;top:.25in}.ðŸ“–-left .ðŸ“–-running-header{left:18pt;text-align:left}.ðŸ“–-right .ðŸ“–-running-header{right:18pt;text-align:right}.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-outward,.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-spread-clockwise,.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-inward,.ðŸ“–-rotate-container.ðŸ“–-rotate-clockwise{transform:rotate(90deg) translate3d(0,-100%,0);transform-origin:top left}.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-inward,.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-spread-counterclockwise,.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-outward,.ðŸ“–-rotate-container.ðŸ“–-rotate-counterclockwise{transform:rotate(-90deg) translate3d(-100%,0,0);transform-origin:top left}.ðŸ“–-rotate-container{position:absolute}.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-clockwise .ðŸ“–-background{bottom:0}.ðŸ“–-left .ðŸ“–-rotate-container.ðŸ“–-rotate-counterclockwise .ðŸ“–-background,.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-clockwise .ðŸ“–-background{top:0}.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-counterclockwise .ðŸ“–-background,.ðŸ“–-rotate-container.ðŸ“–-rotate-inward .ðŸ“–-background{bottom:0}.ðŸ“–-rotate-container.ðŸ“–-rotate-outward .ðŸ“–-background{top:0}.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-spread-clockwise{transform:rotate(90deg) translate3d(0,-50%,0);transform-origin:top left}.ðŸ“–-right .ðŸ“–-rotate-container.ðŸ“–-rotate-spread-counterclockwise{transform:rotate(-90deg) translate3d(-100%,-50%,0);transform-origin:top left}@media screen{.ðŸ“–-viewing{background:#f4f4f4!important}.ðŸ“–-root{transition:opacity .2s;opacity:1;background:#f4f4f4;padding:10px;z-index:2;position:relative;padding-top:60px;min-height:90vh}.ðŸ“–-progress-bar{position:fixed;left:0;top:0;background:var(--bindery-ui-accent,#0000c5);width:0;transition:all .2s;opacity:0;height:0;z-index:2}.ðŸ“–-in-progress .ðŸ“–-progress-bar{opacity:1;height:2px}.ðŸ“–-measure-area{position:fixed;background:#f4f4f4;padding:50px 20px;z-index:2;visibility:hidden;left:0;right:0;bottom:0}.ðŸ“–-measure-area .ðŸ“–-page{margin:0 auto 50px}.ðŸ“–-is-overflowing{border-bottom:1px solid #f0f}.ðŸ“–-print-page{margin:0 auto}.ðŸ“–-error{font:16px/1.4 -apple-system,BlinkMacSystemFont,Roboto,sans-serif;padding:15vh 15vw;z-index:3;position:fixed;top:0;left:0;right:0;bottom:0;background:hsla(0,0%,96%,.7)}.ðŸ“–-error-title{font-size:1.5em;margin-bottom:16px}.ðŸ“–-error-text{margin-bottom:16px;white-space:pre-line}.ðŸ“–-error-footer{opacity:.5;font-size:.66em;text-transform:uppercase;letter-spacing:.02em}.ðŸ“–-show-bleed .ðŸ“–-print-page{background:#fff;outline:1px solid rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.2);margin:20px auto}.ðŸ“–-placeholder-pulse{animation:pulse 1s infinite}}@keyframes pulse{0%{opacity:.2}50%{opacity:.5}to{opacity:.2}}@page{margin:0}@media print{.ðŸ“–-root *{-webkit-print-color-adjust:exact;color-adjust:exact}.ðŸ“–-controls,.ðŸ“–-viewing>:not(.ðŸ“–-root){display:none!important}.ðŸ“–-print-page{padding:1px;margin:0 auto}.ðŸ“–-zoom-wrap[style]{transform:none!important}}body.ðŸ“–-viewing{margin:0}.ðŸ“–-zoom-wrap{transform-origin:top left;transform-style:preserve-3d;height:calc(100vh - 120px)}[bindery-view-mode=interactive] .ðŸ“–-zoom-wrap{transform-origin:center left}.ðŸ“–-viewing>:not(.ðŸ“–-root):not(.ðŸ“–-measure-area){display:none!important}.ðŸ“–-print-page{page-break-after:always;overflow:hidden;align-items:center;transition:all .2s}.ðŸ“–-print-page,.ðŸ“–-spread-wrapper{position:relative;display:flex;justify-content:center}.ðŸ“–-spread-wrapper{margin:0 auto 32px}.ðŸ“–-print-page .ðŸ“–-spread-wrapper{margin:0 auto}.ðŸ“–-flap-holder{perspective:5000px;position:absolute;top:0;right:0;left:0;bottom:0;margin:auto;transform-style:preserve-3d}.ðŸ“–-flip-sizer{position:relative;margin:auto;padding:0 20px;box-sizing:content-box;height:100%!important}.ðŸ“–-page3d{margin:auto;width:var(--bindery-page-width);height:var(--bindery-page-height);transform:rotateY(0);transform-style:preserve-3d;transform-origin:left;transition:transform .5s,box-shadow .1s;position:absolute;left:0;right:0;top:0;bottom:0}.ðŸ“–-page3d:hover{box-shadow:2px 0 4px rgba(0,0,0,.2)}.ðŸ“–-page3d.flipped{transform:rotateY(-180deg)}.ðŸ“–-page3d .ðŸ“–-page{position:absolute;backface-visibility:hidden;-webkit-backface-visibility:hidden;box-shadow:none}.ðŸ“–-page3d .ðŸ“–-page3d-front{transform:rotateY(0)}.ðŸ“–-page3d .ðŸ“–-page3d-back{transform:rotateY(-180deg)}.ðŸ“–-print-mark-wrap{display:none;position:absolute;pointer-events:none;top:0;bottom:0;left:0;right:0;z-index:3}.ðŸ“–-show-bleed-marks .ðŸ“–-print-mark-wrap,.ðŸ“–-show-bleed-marks .ðŸ“–-print-mark-wrap>[class*=bleed],.ðŸ“–-show-crop .ðŸ“–-print-mark-wrap,.ðŸ“–-show-crop .ðŸ“–-print-mark-wrap>[class*=crop]{display:block}.ðŸ“–-print-mark-wrap>div{display:none;position:absolute;overflow:hidden}.ðŸ“–-print-mark-wrap>div:after,.ðŸ“–-print-mark-wrap>div:before{content:"";display:block;position:absolute}.ðŸ“–-print-mark-wrap>div:before{top:0;left:0}.ðŸ“–-print-mark-wrap>div:after{bottom:0;right:0}.ðŸ“–-bleed-left,.ðŸ“–-bleed-right,.ðŸ“–-crop-fold,.ðŸ“–-crop-left,.ðŸ“–-crop-right{width:1px;margin:auto}.ðŸ“–-bleed-left:after,.ðŸ“–-bleed-left:before,.ðŸ“–-bleed-right:after,.ðŸ“–-bleed-right:before,.ðŸ“–-crop-fold:after,.ðŸ“–-crop-fold:before,.ðŸ“–-crop-left:after,.ðŸ“–-crop-left:before,.ðŸ“–-crop-right:after,.ðŸ“–-crop-right:before{width:1px;height:12pt;background-image:linear-gradient(90deg,#000 0,#000 51%,transparent 0);background-size:1px 100%}.ðŸ“–-bleed-bottom,.ðŸ“–-bleed-top,.ðŸ“–-crop-bottom,.ðŸ“–-crop-top{height:1px}.ðŸ“–-bleed-bottom:after,.ðŸ“–-bleed-bottom:before,.ðŸ“–-bleed-top:after,.ðŸ“–-bleed-top:before,.ðŸ“–-crop-bottom:after,.ðŸ“–-crop-bottom:before,.ðŸ“–-crop-top:after,.ðŸ“–-crop-top:before{width:12pt;height:1px;background-image:linear-gradient(180deg,#000 0,#000 51%,transparent 0);background-size:100% 1px}.ðŸ“–-crop-fold{right:0;left:0}.ðŸ“–-crop-left{left:0}.ðŸ“–-crop-right{right:0}.ðŸ“–-crop-top{top:0}.ðŸ“–-crop-bottom{bottom:0}.ðŸ“–-print-meta{padding:12pt;text-align:center;font-family:-apple-system,BlinkMacSystemFont,Roboto,sans-serif;font-size:8pt;display:block!important;position:absolute;bottom:-60pt;left:0;right:0}');var je=function(){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i),console.log("ðŸ“– Bindery "+e),this.autorun=r.autorun||!0,this.autoupdate=r.autoupdate||!1,x.isDebugging=r.debug||v("debug")||!1,b.validate(r,{name:"makeBook",autorun:b.bool,content:b.any,ControlsComponent:b.any,pageSetup:b.shape({name:"pageSetup",bleed:b.length,margin:b.shape({name:"margin",top:b.length,inner:b.length,outer:b.length,bottom:b.length}),size:b.shape({name:"size",width:b.length,height:b.length})}),view:b.enum.apply(b,a(Object.values($))),printSetup:b.shape({name:"printSetup",layout:b.enum.apply(b,a(Object.values(ee))),marks:b.enum.apply(b,a(Object.values(te))),paper:b.enum.apply(b,a(Object.values(Q)))}),rules:b.array}),this.pageSetup=new se(r.pageSetup),this.pageSetup.setupPaper(r.printSetup);var o=r.printSetup?r.printSetup.layout||ee.PAGES:ee.PAGES,s=r.printSetup?r.printSetup.marks||te.CROP:te.CROP;if(this.viewer=new Se({bindery:this,mode:r.view||$.PREVIEW,marks:s,layout:o,ControlsComponent:r.ControlsComponent}),this.rules=Me,r.rules&&this.addRules(r.rules),r.content)if("string"==typeof r.content){if(this.source=document.querySelector(r.content),!(this.source instanceof HTMLElement))return this.viewer.displayError("Content not specified",'Could not find element that matches selector "'+r.content+'"'),void console.error('Bindery: Could not find element that matches selector "'+r.content+'"');this.autorun&&this.makeBook()}else if("object"===t(r.content)&&r.content.url){var l=r.content.url,u=r.content.selector;this.fetchSource(l,u)}else r.content instanceof HTMLElement?(this.source=r.content,this.autorun&&this.makeBook()):console.error("Bindery: Source must be an element or selector");else this.viewer.displayError("Content not specified","You must include a source element, selector, or url"),console.error("Bindery: You must include a source element or selector")}return r(i,[{key:"fetchSource",value:function(e,t){var n=this;fetch(e).then(function(t){if(404===t.status)n.viewer.displayError("404",'Could not find file at "'+e+'"');else if(200===t.status)return t.text();return""}).then(function(e){var r=document.createElement("div");if(r.innerHTML=e,n.source=r.querySelector(t),!(n.source instanceof HTMLElement))return n.viewer.displayError("Source not specified",'Could not find element that matches selector "'+t+'"'),void console.error('Bindery: Could not find element that matches selector "'+t+'"');n.autorun&&n.makeBook()}).catch(function(t){console.error(t),"file"===window.location.href.split("://")[0]&&n.viewer.displayError("Can't fetch content from \""+e+'"',"Web pages can't fetch content unless they are on a server.")})}},{key:"cancel",value:function(){this.viewer.cancel(),document.body.classList.remove(k("viewing")),this.source.style.display=""}},{key:"addRules",value:function(e){var t=this;e.forEach(function(e){if(!(e instanceof Le.Rule))throw Error("Bindery: The following is not an instance of Bindery.Rule and will be ignored: "+e);t.rules.push(e)})}},{key:"updateBookSilent",value:function(){var e=this;this.layoutComplete=!1,this.source.style.display="";var t=this.source.cloneNode(!0);this.source.style.display="none",document.body.classList.add(k("viewing")),this.pageSetup.updateStylesheet(),X({content:t,rules:this.rules,success:function(t){e.viewer.book=t,e.viewer.render(),e.layoutComplete=!0},progress:function(){},error:function(t){e.layoutComplete=!0,e.viewer.displayError("Layout failed",t)}})}},{key:"makeBook",value:function(e){var t=this;if(this.source){if(this.layoutComplete=!1,!this.pageSetup.isSizeValid())return this.viewer.displayError("Page is too small","Size: "+JSON.stringify(this.pageSize)+" \n Margin: "+JSON.stringify(this.pageMargin)+" \n Try adjusting the sizes or units."),void console.error("Bindery: Cancelled pagination. Page is too small.");this.source.style.display="";var n=this.source.cloneNode(!0);this.source.style.display="none",this.viewer.clear(),document.body.classList.add(k("viewing")),x.isDebugging&&document.body.classList.add(k("debug")),this.pageSetup.updateStylesheet(),this.viewer.setInProgress(),X(n,this.rules).progress(function(e){t.viewer.renderProgress(e)}).then(function(n){t.viewer.book=n,t.viewer.render(),t.layoutComplete=!0,e&&e(),t.viewer.element.classList.remove(k("in-progress")),document.body.classList.remove(k("debug"))}).catch(function(e){t.layoutComplete=!0,t.viewer.element.classList.remove(k("in-progress")),t.viewer.displayError("Layout couldn't complete",e)})}else document.body.classList.add(k("viewing"))}}],[{key:"makeBook",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.autorun=!e.autorun||e.autorun,new i(e)}}]),i}();je.version=e;var De=Object.assign(je,Le);return De.View=$,De.Paper=Q,De.Layout=ee,De.Marks=te,De}();
//# sourceMappingURL=bindery.min.js.map
